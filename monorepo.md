ğŸ§± ä¸€ã€ä½ ç›®å‰çš„åœºæ™¯é€‚åˆ Monorepo å—ï¼Ÿ
âœ… ä½ çš„ç°çŠ¶éå¸¸é€‚åˆï¼š
å¤šä¸ªåŠŸèƒ½é‡å æˆ–å…±äº«åŸºç¡€è®¾æ–½çš„ç³»ç»Ÿï¼ˆå¦‚ç»„ä»¶åº“ã€å·¥å…·å‡½æ•°ã€è¯·æ±‚å°è£…ã€æƒé™ç³»ç»Ÿç­‰ï¼‰

ç³»ç»Ÿç‹¬ç«‹éƒ¨ç½²ã€åŠŸèƒ½å®šä½ä¸åŒï¼Œä½†æœ‰ä¸€å®šä»£ç å’Œèµ„æºçš„å¤ç”¨

ä½ ä½œä¸ºæ¶æ„æ¨åŠ¨è€…ï¼Œæœ‰èƒ½åŠ›åè°ƒè·¨ç³»ç»Ÿçš„ç»“æ„ä¼˜åŒ–

âš™ï¸ äºŒã€ä»€ä¹ˆæ˜¯ Monorepoï¼Ÿ
Monorepoï¼ˆMonolithic Repositoryï¼‰ï¼šå°†å¤šä¸ªç›¸å…³é¡¹ç›®ç»Ÿä¸€ç®¡ç†åœ¨ä¸€ä¸ª Git ä»“åº“ä¸­çš„ä»£ç ç®¡ç†ç­–ç•¥ã€‚

ğŸš© ä¸ä¹‹å¯¹åº”çš„æ˜¯ï¼š
Polyrepoï¼ˆå¤šä»“åº“ï¼‰ï¼šæ¯ä¸ªç³»ç»Ÿ/æ¨¡å—ä¸€ä¸ªç‹¬ç«‹ä»“åº“

âš–ï¸ ä¸‰ã€Monorepo çš„ä¼˜åŠ£åŠ¿åˆ†æï¼ˆé’ˆå¯¹é—¨åº—å¤šç³»ç»Ÿï¼‰
é¡¹ç›®	ä¼˜åŠ¿	åŠ£åŠ¿
âœ… ä»£ç å…±äº«	å…¬å…±ç»„ä»¶ã€å·¥å…·å‡½æ•°ã€é…ç½®ç­‰å®¹æ˜“å¤ç”¨ã€ç‰ˆæœ¬ä¸€è‡´	å¦‚æœæ²¡è®¾è®¡å¥½ä¾èµ–å…³ç³»ï¼Œå®¹æ˜“è€¦åˆ
âœ… ç»Ÿä¸€å¼€å‘ä½“éªŒ	ESLintã€Prettierã€TS é…ç½®ä¸€è‡´ï¼Œé¿å…å¤šé¡¹ç›®ä¸ç»Ÿä¸€é—®é¢˜	åˆæœŸæ­å»ºå¤æ‚
âœ… ç»Ÿä¸€æµ‹è¯•/CI/CD æµç¨‹	å¯ä»¥åœ¨åŒä¸€æµæ°´çº¿ä¸­æµ‹è¯•å¤šä¸ªç³»ç»Ÿï¼Œæå‡è‡ªåŠ¨åŒ–æ•ˆç‡	CI å¤æ‚åº¦ä¸Šå‡ï¼Œéœ€è¦æ™ºèƒ½è¯†åˆ«å˜æ›´é¡¹ç›®
âœ… æå‡ç»´æŠ¤æ•ˆç‡	Bug ä¿®å¤ä¸€æ¬¡è¦†ç›–å¤šä¸ªç³»ç»Ÿï¼›è¿ç§»/å‡çº§ä¸€ç«™å¼æ“ä½œ	éç»éªŒå›¢é˜Ÿå®¹æ˜“â€œç‰µä¸€å‘è€ŒåŠ¨å…¨èº«â€
âœ… å›¢é˜Ÿåä½œé¡ºç•…	å¤šäººå¯ä¸“æ³¨äºæŸç³»ç»Ÿã€å…±äº«æ¨¡å—æ— éœ€è·¨ä»“åº“æäº¤/å‘å¸ƒ	Git ä½“ç§¯éšæ—¶é—´å¯èƒ½è†¨èƒ€
âŒ å­¦ä¹ æˆæœ¬	åˆæ¬¡æ¥è§¦ Monorepo æ¶æ„çš„åŒäº‹éœ€ç†Ÿæ‚‰ Lerna/Turbo ç­‰å·¥å…·	éœ€å›¢é˜ŸåŸ¹è®­å’Œè§„èŒƒæ–‡æ¡£

ğŸ§© å››ã€æŠ€æœ¯é€‰å‹å»ºè®®
ä½ å¯ä»¥é€‰æ‹©ç°ä»£æµè¡Œçš„ Monorepo å·¥å…·ï¼š

å·¥å…·	ä¼˜åŠ¿	ç”¨é€”å»ºè®®
Turborepo	Vercel å‡ºå“ï¼Œæé€Ÿç¼“å­˜ã€æ”¯æŒå¹¶è¡Œä»»åŠ¡	âœ… æ¨èï¼Œç°ä»£æ„å»ºä½“éªŒæœ€ä½³
Nx	é¢å‘ä¼ä¸šé¡¹ç›®ï¼Œä¾èµ–å›¾ã€å¾®æœåŠ¡æ”¯æŒå¼º	å¦‚æœä½ æœ‰ Node.js æœåŠ¡ã€å‰åç«¯ç»Ÿä¸€ç®¡ç†
Lerna	è€ç‰Œå·¥å…·ï¼Œç»“åˆ Yarn/NPM Workspaces	ç”¨äºåŸºç¡€åŒ…ç®¡ç†ã€å‘å¸ƒ
pnpm Workspaces	å¿«é€Ÿã€èŠ‚çœç£ç›˜ç©ºé—´	é…åˆ Turbo æ›´å¼º

æœ€ä½³ç»„åˆæ¨èï¼š
ğŸ‘‰ pnpm + turborepo + Nxï¼ˆå¯é€‰ï¼‰ï¼šç°ä»£ã€å¿«ã€æ”¯æŒå¾®æœåŠ¡ã€CIå‹å¥½ã€‚

ğŸ§­ äº”ã€Monorepo çš„é¡¹ç›®ç»“æ„å»ºè®®ï¼ˆé€‚åˆé—¨åº—å¤šä¸ªå¹³å°ï¼‰
bash
å¤åˆ¶
ç¼–è¾‘
monorepo-root/
â”‚
â”œâ”€â”€ apps/
â”‚   â”œâ”€â”€ store-regulation/       # é—¨åº—ç›‘ç®¡å¹³å°
â”‚   â”œâ”€â”€ store-operations/       # é—¨åº—è¥è¿å¹³å°
â”‚   â””â”€â”€ store-management/       # é—¨åº—ç®¡ç†å¹³å°
â”‚
â”œâ”€â”€ packages/
â”‚   â”œâ”€â”€ ui/                     # å…¬å…±ç»„ä»¶åº“
â”‚   â”œâ”€â”€ utils/                  # é€šç”¨å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ api/                    # è¯·æ±‚å°è£…ï¼Œç»Ÿä¸€æ¥å£
â”‚   â””â”€â”€ config/                 # ç¯å¢ƒé…ç½®ã€æƒé™ã€i18n ç­‰
â”‚
â”œâ”€â”€ turbo.json                 # Turborepo é…ç½®
â”œâ”€â”€ pnpm-workspace.yaml        # pnpm é…ç½®
â”œâ”€â”€ tsconfig.base.json         # å…¬å…± TS é…ç½®
â””â”€â”€ .eslintrc.js               # ç»Ÿä¸€ lint é…ç½®
ğŸ§ª å…­ã€éœ€è¦é‡ç‚¹è§£å†³çš„æŠ€æœ¯é—®é¢˜
1. ä¾èµ–ç®¡ç†
ä½¿ç”¨ pnpm workspaces å®ç°å†…éƒ¨åŒ…è‡ªåŠ¨é“¾æ¥

é¿å…â€œåŒ…ä¹‹é—´å¾ªç¯ä¾èµ–â€é—®é¢˜

2. å…¬å…±æ¨¡å—å‡çº§å‘å¸ƒæœºåˆ¶
æ¨èä¸å•ç‹¬å‘å¸ƒ npm åŒ…ï¼Œè€Œæ˜¯å†…éƒ¨å¼•ç”¨

è‹¥å‘å¸ƒï¼Œéœ€è¦é…åˆ changeset è¿›è¡Œç‰ˆæœ¬ç®¡ç†

3. æ„å»ºæ€§èƒ½ä¼˜åŒ–
Turbo æ”¯æŒæŒ‰éœ€æ„å»ºã€ç¼“å­˜ã€å¹¶è¡Œæ‰§è¡Œä»»åŠ¡ï¼ˆå¦‚ buildã€lintã€testï¼‰

4. CI/CD æ•´åˆ
åˆ†ç³»ç»Ÿéƒ¨ç½²å¯ç»“åˆ Turbo çš„å˜æ›´æ£€æµ‹æœºåˆ¶ï¼š

bash
å¤åˆ¶
ç¼–è¾‘
turbo run build --filter=store-regulation
5. ä»£ç éš”ç¦»ä¸è§„èŒƒ
æ¯ä¸ªç³»ç»Ÿä»ä¿æŒç‹¬ç«‹å¼€å‘ä¹ æƒ¯ï¼ˆå¦‚é¡µé¢ç»“æ„ã€çŠ¶æ€ç®¡ç†ã€æ•°æ®è¯·æ±‚é€»è¾‘ï¼‰

å…¬å…±æ¨¡å—ç»Ÿä¸€ç”±ä½ å›¢é˜Ÿç»´æŠ¤ï¼Œä¿éšœè´¨é‡å’Œå˜æ›´å®¡æŸ¥æœºåˆ¶

ğŸ“Œ ä¸ƒã€ä»€ä¹ˆæ—¶å€™ä¸å»ºè®® Monorepoï¼Ÿ
ç³»ç»Ÿå®Œå…¨ç‹¬ç«‹ã€æœªæ¥æ‹†åˆ†åˆ°å¤šä¸ªå…¬å¸/å›¢é˜Ÿç»´æŠ¤ï¼›

å›¢é˜Ÿç»éªŒä¸è¶³ï¼Œå¯¹ä¾èµ–å…³ç³»ç®¡ç†èƒ½åŠ›å¼±ï¼›

ä¸å…·å¤‡ DevOps/CI èƒ½åŠ›å»æ”¯æŒå¤šç³»ç»Ÿè”åŠ¨å‘å¸ƒï¼›

âœ… æ€»ç»“ï¼šä½ çš„å½“å‰æƒ…å†µï¼Œå¼ºçƒˆå»ºè®®ä½¿ç”¨ Monorepo
æ¡ä»¶	è¯´æ˜
å¤šç³»ç»Ÿï¼ˆç›‘ç®¡/ç®¡ç†/è¥è¿ï¼‰	âœ… éå¸¸é€‚åˆæ•´åˆå¼ç®¡ç†
ç³»ç»Ÿé—´æœ‰å¤ç”¨æ¨¡å—ï¼ˆç»„ä»¶/æƒé™/apiï¼‰	âœ… åˆ©äºç‰ˆæœ¬ç»Ÿä¸€å’Œè¿­ä»£
ä½ æœ‰èƒ½åŠ›æ¨åŠ¨æ¶æ„	âœ… æœ‰ä¸­å°ç»éªŒè€…é€‚åˆä¸»å¯¼
æœ‰å›¢é˜Ÿåä½œå’Œè§„èŒƒèƒ½åŠ›	âœ… æˆä¸ºè§„èŒƒåˆ¶å®šè€…ï¼Œæ˜¯ä½ æˆé•¿çš„çªç ´å£

å¦‚æœä½ æ„¿æ„ï¼Œæˆ‘å¯ä»¥å¸®ä½ ç»§ç»­åšè¿™äº›ï¼š

ğŸ“ ä¸ºä½ è¾“å‡ºä¸€ä»½ é€‚é…ä½ å…¬å¸çš„ Monorepo æ–‡ä»¶ç»“æ„æ¨¡æ¿

ğŸ§± ç¼–å†™ä¸€å¥—ç”¨äºé—¨åº—ç³»ç»Ÿçš„ Turbo + pnpm çš„å®Œæ•´é…ç½®

ğŸ“œ è¾“å‡ºä¸€ä»½ å›¢é˜Ÿ Monorepo å¼€å‘è§„èŒƒæ–‡æ¡£ï¼ˆTSã€ç»„ä»¶ã€å‘å¸ƒç­‰ï¼‰

å‘Šè¯‰æˆ‘ä½ æƒ³è¦å“ªä¸€é¡¹ï¼Œæˆ‘å¯ä»¥ç°åœ¨å¼€å§‹å¸®ä½ ç”Ÿæˆã€‚






æ‚¨è¯´ï¼š
éƒ½è¦


ChatGPT è¯´ï¼š
å·²æ›´æ–°ä¿å­˜çš„è®°å¿†
Monorepo-setup-guide

22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
monorepo-root/
â”œâ”€â”€ tsconfig.base.json         # TS é¡¹ç›®åŸºç¡€é…ç½®
â”œâ”€â”€ pnpm-workspace.yaml        # workspace ç®¡ç†
â”œâ”€â”€ turbo.json                 # Turborepo æ„å»ºä¼˜åŒ–é…ç½®
â””â”€â”€ README.md

// pnpm-workspace.yaml
packages:
  - "apps/*"
  - "packages/*"

// turbo.json
{
  "$schema": "https://turborepo.org/schema.json",
  "pipeline": {
    "build": {
      "dependsOn": ["^build"],
      "outputs": ["dist/**"]
    },
    "dev": {
      "cache": false
    },
    "lint": {},
    "test": {}
  }
}

// tsconfig.base.json
{
  "compilerOptions": {
    "target": "ESNext",
    "module": "ESNext",
    "moduleResolution": "Node",
    "strict": true,
    "baseUrl": ".",
    "paths": {
      "@ui/*": ["packages/ui/src/*"],
      "@utils/*": ["packages/utils/src/*"],
      "@api/*": ["packages/api/src/*"]
    }
  }
}

// .eslintrc.js
module.exports = {
  root: true,
  extends: ["eslint:recommended", "plugin:react/recommended", "plugin:@typescript-eslint/recommended"],
  parser: "@typescript-eslint/parser",
  plugins: ["@typescript-eslint"],
  rules: {
    // è‡ªå®šä¹‰è§„åˆ™
  }
};

å·²ä¸ºä½ ç”Ÿæˆä¸€ä»½å®Œæ•´çš„ Monorepo é¡¹ç›®ç»“æ„ã€é…ç½®æ¨¡æ¿å’Œç»Ÿä¸€è§„èŒƒï¼Œé€‚é…ä½ é—¨åº—ä¸šåŠ¡çš„å¤šå¹³å°ç³»ç»Ÿã€‚ä¸‹ä¸€æ­¥ï¼Œæˆ‘å°†ä¸ºä½ è¾“å‡ºä¸€ä»½é€‚åˆå›¢é˜Ÿå†…éƒ¨ä½¿ç”¨çš„ã€ŒMonorepo å¼€å‘è§„èŒƒæ–‡æ¡£ã€ï¼ŒåŒ…æ‹¬æ¨¡å—ç®¡ç†ã€åˆ†æ”¯åä½œã€ç»„ä»¶ä½¿ç”¨ã€å‘å¸ƒæµç¨‹ç­‰è§„èŒƒï¼Œæ–¹ä¾¿å›¢é˜Ÿç»Ÿä¸€åä½œã€‚

æ˜¯å¦å¸Œæœ›æˆ‘ç»§ç»­å°†è¿™ä»½è§„èŒƒæ–‡æ¡£ä¹Ÿå†™æˆ canvas æ–‡æ¡£ï¼Ÿå¦‚æœä½ å¸Œæœ›ä»¥ Markdown æ ¼å¼å¯¼å‡ºï¼Œæˆ‘ä¹Ÿå¯ä»¥ç›´æ¥æä¾›ã€‚è¯·å‘Šè¯‰æˆ‘ä½ æ›´å¸Œæœ›å“ªç§æ–¹å¼ã€‚






æ‚¨è¯´ï¼š
å¦‚ä½•åšåˆ°å˜æ›´å•ä¸€ç³»ç»Ÿ,æˆ‘åªå‘å¸ƒå¯¹åº”å˜æ›´çš„ç³»ç»Ÿ,å…¶ä»–ç³»ç»Ÿä¿æŒä¸å˜


ChatGPT è¯´ï¼š
è¿™æ˜¯ Monorepo å®è·µä¸­çš„æ ¸å¿ƒé—®é¢˜ä¹‹ä¸€ï¼šå¦‚ä½•åªæ„å»º / æµ‹è¯• / å‘å¸ƒè¢«æ”¹åŠ¨çš„ç³»ç»Ÿï¼Œè€Œä¸å½±å“å…¶å®ƒç³»ç»Ÿã€‚

ä½ å¯ä»¥é€šè¿‡ä»¥ä¸‹æŠ€æœ¯æ ˆç»„åˆï¼Œå®ç°ã€Œå•ç³»ç»Ÿå˜æ›´æ—¶ï¼Œä»…æ„å»ºè¯¥ç³»ç»Ÿã€çš„èƒ½åŠ›ï¼š

âœ… è§£å†³æ–¹æ¡ˆæ€»è§ˆ
å·¥å…·/æ¦‚å¿µ	ä½œç”¨	è¯´æ˜
Turborepo	æ„å»ºåŠ é€Ÿ + ç¼“å­˜ + å˜æ›´æ£€æµ‹	è‡ªåŠ¨è¿½è¸ªå“ªäº›ç³»ç»Ÿ/åŒ…å‘ç”Ÿå˜æ›´
Git æäº¤å˜æ›´è¿½è¸ª	åˆ¤æ–­å“ªäº›ç›®å½•è¢«æ”¹åŠ¨	å¯ç»“åˆ git diff ä¸ Turbo é…åˆ
æŒ‰éœ€æ„å»º/éƒ¨ç½²	ç»“åˆ Turbo + CI è„šæœ¬ + ç¯å¢ƒå˜é‡	æ„å»ºè§¦å‘æœ€å°ç³»ç»Ÿå­é›†
CI/CDï¼ˆå¦‚ GitHub Actionsï¼‰	æ‰§è¡Œæ„å»ºä¸éƒ¨ç½²æµç¨‹	å°†å˜æ›´æ£€æµ‹é€»è¾‘è‡ªåŠ¨é›†æˆ

ğŸ§± å®æ“æ¼”ç¤ºï¼šä½¿ç”¨ Turborepo + pnpm å®ç°æœ€å°å‘å¸ƒ
1. âœ… Turbo èƒ½åŠ›ï¼šæŒ‰éœ€æ‰§è¡Œæ„å»ºä»»åŠ¡
Turbo æä¾› --filter å‚æ•°ï¼Œå¯æŒ‰é¡¹ç›®åç§°ç­›é€‰ï¼š

bash
å¤åˆ¶
ç¼–è¾‘
# åªæ„å»ºç›‘ç®¡å¹³å°ï¼ˆapps/store-regulationï¼‰
turbo run build --filter=store-regulation
ä¹Ÿå¯ä»¥è‡ªåŠ¨æ¨æ–­å“ªäº›ç³»ç»Ÿâ€œå—å½±å“â€ï¼š

bash
å¤åˆ¶
ç¼–è¾‘
# Turbo è‡ªåŠ¨åˆ¤æ–­å“ªäº›é¡¹ç›®è‡ªä¸Šæ¬¡ commit åå‘ç”Ÿå˜æ›´
turbo run build --filter=...[HEAD^]
ğŸ” ç¤ºä¾‹å«ä¹‰ï¼š

...[HEAD^]ï¼šä»ä¸Šä¸€æ¬¡ commit å¼€å§‹ï¼Œå“ªäº›é¡¹ç›®å˜æ›´äº†ï¼Œæ„å»ºå®ƒä»¬

å¯ç”¨äºè‡ªåŠ¨åŒ– CI/CD ä¸­çš„æ™ºèƒ½éƒ¨ç½²

2. ğŸ› ï¸ CI/CD ä¸­çš„å®é™…è„šæœ¬ï¼ˆä»¥ GitHub Actions ä¸ºä¾‹ï¼‰
yaml
å¤åˆ¶
ç¼–è¾‘
jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: å®‰è£…ä¾èµ–
        run: pnpm install

      - name: è·å–å‘ç”Ÿå˜æ›´çš„é¡¹ç›®
        id: changed
        run: |
          echo "CHANGED=$(pnpm turbo run build --dry=json --filter=...[HEAD^] | jq -r '.packages[].name')" >> $GITHUB_OUTPUT

      - name: æ„å»ºå˜æ›´é¡¹ç›®
        if: ${{ steps.changed.outputs.CHANGED != '' }}
        run: |
          for pkg in ${{ steps.changed.outputs.CHANGED }}
          do
            echo "ğŸ”§ æ„å»º $pkg"
            pnpm turbo run build --filter=$pkg
          done
3. ğŸ“¦ éƒ¨ç½²ï¼šå¦‚ä½•æŒ‰ç³»ç»Ÿå‘å¸ƒ
æ¯ä¸ªç³»ç»Ÿå¯ä»¥å®šä¹‰ç‹¬ç«‹éƒ¨ç½²è„šæœ¬ï¼ˆCI æ­¥éª¤ä¸­é€šè¿‡åˆ¤æ–­ filter é¡¹ç›®è§¦å‘éƒ¨ç½²ï¼‰ï¼š

apps/store-regulation/build.sh

apps/store-management/deploy.sh

CI ä¸­æ‰§è¡Œæ–¹å¼ï¼š

bash
å¤åˆ¶
ç¼–è¾‘
pnpm turbo run deploy --filter=store-regulation
4. âœ… æ¯ä¸ªç³»ç»Ÿçš„ package.json å†…éƒ¨åå­—ï¼ˆç”¨äº turbo è¯†åˆ«ï¼‰
json
å¤åˆ¶
ç¼–è¾‘
{
  "name": "store-regulation",
  "version": "1.0.0",
  "scripts": {
    "build": "vite build",
    "dev": "vite",
    "deploy": "./deploy.sh"
  }
}
ğŸ“Œ å°ç»“ï¼šå‘å¸ƒå•ç³»ç»Ÿçš„å…³é”®æ ¸å¿ƒæ˜¯
æ­¥éª¤	æŠ€æœ¯/å·¥å…·	è¦ç‚¹
å˜æ›´æ£€æµ‹	turbo run --filter=...[HEAD^]	ç²¾ç¡®è¯†åˆ«å˜æ›´çš„åŒ…/ç³»ç»Ÿ
ç‹¬ç«‹æ„å»ºè„šæœ¬	æ¯ä¸ªç³»ç»Ÿä¸€ä¸ª build å‘½ä»¤	æ„å»ºäº’ä¸å¹²æ‰°
ç‹¬ç«‹éƒ¨ç½²é€»è¾‘	æ¯ä¸ªç³»ç»Ÿä¸€ä¸ªéƒ¨ç½²è„šæœ¬æˆ–éƒ¨ç½²ç¯å¢ƒ	é¿å…ç³»ç»Ÿé—´è€¦åˆ
CI/CD é›†æˆ	GitHub Actions / GitLab CI ç­‰	è‡ªåŠ¨æ‰§è¡Œå˜æ›´æ„å»ºå‘å¸ƒ

å¦‚æœä½ éœ€è¦ï¼Œæˆ‘å¯ä»¥ï¼š

ğŸ’¡ å¸®ä½ ç”Ÿæˆå®Œæ•´çš„ GitHub Actions è„šæœ¬

ğŸ“ ä¸ºæ¯ä¸ªç³»ç»Ÿè®¾è®¡ build/deploy çš„æ¨¡æ¿

ğŸ“˜ å‡ºä¸€ä»½ â€œå•ç³»ç»Ÿæ™ºèƒ½æ„å»ºä¸éƒ¨ç½²æ‰‹å†Œï¼ˆé€‚é… Turborepoï¼‰â€

