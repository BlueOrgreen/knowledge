

## DNS相关知识

https://www.guokeyun.com/news/index.html?tag=DNS%E8%A7%A3%E6%9E%90%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98


## Web 通信流程

- 浏览器输入url后, 先请求DNS服务器获取域名对应的IP
- 通过IP地址找到IP对应的服务器, 然后建立TCP连接
- 服务端接收到浏览器发来的HTTP请求, 如果请求的资源包含有动态语言的内容, 服务器会调用服务处理得到数据返回给客户端 (`Response数据包的响应, 会根据用户的请求url格式, nginx自动判断是动态请求数据库的内容, 还是静态的查找图片(请求nfs`)
- 浏览器接收到响应体的全部内容后断开与服务器的连接(服务器的连接是有限制的， 默认最大是65535个连接)

### 客户端请求到服务端流程

- 当客户端拿到服务器域名对应的IP后, 浏览器会以一个随机的端口 (1024 < 随机端口 < 65534) 向服务器的web程序(Nginx、Apache)的80端口发起tcp连接请求
- 该请求经过复杂的网络环境后到达服务器, 进入到服务器对应的网卡, 再进入到linux内核的tcp/ip协议栈, 一层层的解开数据包, 甚至经过防火墙, 最终到达Nginx程序, 确认tcp/ip连接
- 确认tcp连接之后, 客户端继续发起http请求

## TCP/IP 协议

TCP协议是一种面向连接的、可靠的、基于字节流的传输层通信协议
IP是TCP/IP体系中的网络层协议, IP只为主机提供一种无连接、不可靠、尽力而为的数据包传输协议
TCP/IP协议不仅是tcp、ip这两个协议, 而是由FTP、SMTP、TCP、UDP、IP等各种协议组层的协议簇


### OSI七层模型
- 主机
1. 应用层: 访问网络服务的接口, 例如为操作系统或者网络应用程序提供访问网络服务的接口, 常见: Telnet、FTP、SNMP、HTTP、DNS等
2. 表示层: 提供数据格式转换服务, 例如: 解密与加密, 图片解码和编码、数据的压缩和解压缩, 常见: URL加密、口令加密、图片编解码
3. 会话层: 建立端连接并提供访问验证和会话管理(session), 常见: 服务器验证用户登录、断电续传
4. 传输层: 提供应用进程之间的逻辑通信, 例如: 建立连接, 处理数据包错误、数据包次序, 常见: TCP、UDP、SPX、进程、端口  -  数据段(Segment)  - ip+port等于一个socket(10.0.0.6:80)套接字连接
- 网络
5. 网络层: 为数据在节点之间传输创建逻辑链路 并分组转发数据, 例如: 对子网间的数据包进行路由选择, 常见: 路由器、多层交换机、防火墙、IP、IPX、RIP、OSPF  -  分组(数据包Packet)
6. 链路层: 在通信实体之间建立数据链路连接, 例如: 将数据分帧、并处理流控制、物理地址寻址、重发等, 常见: 网卡、网桥、二层交换机 - 帧(Frame)  -  网卡都有一个出厂序列号 Mac地址(ifconfig可查看)
7. 物理层: 为数据端设备提供原始比特流的传输通路, 例如:网络通信的数据传输💍, 由电缆和设备共同构成, 常见: 中继器、集线器、网线、HUB - 比特(Bit) -  网卡


## 即时通讯技术对比


|   ---- | 短轮询      | 长轮询       |  长连接(SSE)      | Websocket       |
| --------- | --------- | --------------- | --------- | --------------- |
|   原理  | 客户端每隔一段时间向服务端发起请求 | 客户端发起请求后, 服务器保持连接直到有返回数据或者请求超时后重新发起请求  |  使用HTTP长连接(Keep-Alive),客户端和服务端建立连接后,可以连续发送多个http请求和响应   | 在TCP连接上的全双工协议,客户端和服务器可以随时相互发送数据  |
|   特点  |  实现简单,效率低,会产生大量的请求 |  相比短轮询减少了无效的轮询次数,降低了延迟,但是服务器需要有能力维持多个挂起连接,消耗服务器资源 | TCP连接建立后不马上断开,后续的请求可以不断使用, 省去了重新TCP握手的时间, 适用于一个页面有多个资源请求时 |  真正的双向通信,延迟低

