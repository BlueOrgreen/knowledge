
## é˜²æŠ–

ç®€å•ç‰ˆ

```tsx
function debouced(fun, wait) {
    let timeout;

    return function(...args) {
        const context = this // ä¿å­˜è°ƒç”¨æ—¶çš„ this â†’ context

        clearTimeout(timeout)
        timeout = setTimeout(() => {
            func.apply(context, args)
        }, wait)
    }
}
```

#### ç«‹å³æ‰§è¡Œç‰ˆé˜²æŠ–

æœ‰æ—¶å€™æˆ‘ä»¬æƒ³è¦ `å…ˆç«‹å³æ‰§è¡Œä¸€æ¬¡ï¼Œåç»­é˜²æŠ–`

```js
function debounce(func, wait, immediate) {
    let timeout;

    return function(...args) {
        const context = this

        const callNow = immediate && !timeout;

        clearTimeout(timeout);
        timeout = setTimeout(() => {
            timeout = null;
            if (!immediate) func.apply(context, args);
        }, wait);

        if (callNow) func.apply(context, args);
    }
}
```

#### func.apply(context, args)

> ç¡®ä¿ func è¢«è°ƒç”¨æ—¶ï¼Œå®ƒé‡Œé¢çš„ this å’Œå‚æ•°ï¼Œè·Ÿå¤–é¢è°ƒç”¨æ—¶å®Œå…¨ä¸€æ ·ã€‚

å¦‚æœæ²¡æœ‰ applyï¼Œåœ¨é˜²æŠ–é‡Œ func(args) ä¼šè¿™æ · ä¸¢æ‰è°ƒç”¨çš„thisğŸ‘‡

```js
const input = document.querySelector('input');

function handle(e) {
  console.log(this, e);
}

// â­ this ä¸æ˜¯ç”±ã€Œå‡½æ•°å®šä¹‰ã€å†³å®šçš„ï¼Œè€Œæ˜¯ç”±ã€Œå‡½æ•°è°ƒç”¨æ—¶ã€çš„æ–¹å¼å†³å®šçš„ã€‚
input.addEventListener('input', handle); 
// this = input ; element åœ¨æµè§ˆå™¨è°ƒç”¨ handler çš„æ—¶å€™ä¼šè‡ªåŠ¨ç»‘å®šï¼š

input.addEventListener('input', debounce(handle, 300)); 
// å¦‚æœ debounce é‡Œç›´æ¥ func(e) å°±ä¼šä¸¢æ‰ this â†’ å˜æˆ window

// åœ¨ debounce é‡Œä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ

// é˜²æŠ–çš„åŸç†æ˜¯è¿”å›ä¸€ä¸ªã€ŒåŒ…è£¹å‡½æ•°ã€

// input.addEventListener('input', debouncedFn);  å½“æµè§ˆå™¨è°ƒç”¨è¿™ä¸ªã€Œè¿”å›çš„é˜²æŠ–å‡½æ•°ã€æ—¶ï¼Œthis æ˜¯ input æ²¡é”™

// ä½†æ˜¯ä½ åœ¨é‡Œé¢è°ƒç”¨äº† func(args);  è¿™é‡Œã€Œè°ƒç”¨ funcã€æ²¡æœ‰ä»»ä½•ç»‘å®š
func() â†’ æ™®é€šè°ƒç”¨
// åœ¨éä¸¥æ ¼æ¨¡å¼é‡Œ this â†’ window
// åœ¨ä¸¥æ ¼æ¨¡å¼é‡Œï¼šthis â†’ undefined

```

ä¸€å¥è¯æ€»ç»“:
åœ¨é˜²æŠ–é‡Œå¦‚æœä¸å¤„ç† thisï¼Œè°ƒç”¨åŸå§‹å‡½æ•°æ—¶ä¼šå¤±å»è°ƒç”¨è€…ï¼Œå¯¼è‡´ this å˜æˆ window æˆ– undefinedã€‚ç”¨ apply(context, args) å°±èƒ½ä¿ç•™æ­£ç¡®çš„ this å’Œå‚æ•°


#### é˜²æŠ–ä¸èŠ‚æµ

|      | `é˜²æŠ–ï¼ˆdebounceï¼‰`   | `èŠ‚æµï¼ˆthrottleï¼‰`       |
| ---- | -------------- | ------------------ |
| å®šä¹‰   | åœæ­¢è§¦å‘ä¸€æ®µæ—¶é—´åæ‰è°ƒç”¨ä¸€æ¬¡ | å›ºå®šæ—¶é—´é—´éš”å†…æœ€å¤šè°ƒç”¨ä¸€æ¬¡      |
| å…¸å‹åœºæ™¯ | è¾“å…¥æ¡†æœç´¢ã€è¡¨å•éªŒè¯     | scrollã€resizeã€é¼ æ ‡æ‹–æ‹½ |
| å½¢è±¡ç†è§£ | æ‹–åˆ°æœ€åæ‰ç®—æ•°        | ä¿è¯æŒ‰èŠ‚å¥æŒç»­è§¦å‘          |


#### é˜²æŠ–å‡½æ•°çš„ç®­å¤´å‡½æ•°ç‰ˆæœ¬

é˜²æŠ–å‡½æ•°èƒ½ä¸èƒ½ç”¨ç®­å¤´å‡½æ•°å†™?
ç­”:  1.é˜²æŠ–æœ¬èº«ï¼ˆå¤–å±‚å·¥å‚å‡½æ•°ï¼‰å¯ä»¥ç”¨ç®­å¤´å‡½æ•°å†™; 2.ä½†å†…éƒ¨è¿”å›çš„ `é˜²æŠ–åŒ…è£¹å‡½æ•°` æœ€å¥½ç”¨æ™®é€šå‡½æ•°ï¼Œä»¥æ­£ç¡®è·å¾—è°ƒç”¨æ—¶çš„ `this`

```js
// âœ… æœ€ç®€æ´
// âœ… é€‚ç”¨äºã€Œthis ä¸æ•æ„Ÿã€çš„åœºæ™¯
// âœ… æ¯”å¦‚ï¼šè°ƒç”¨æ—¶ä¸ç”¨å…³å¿ƒ this çš„å·¥å…·æ–¹æ³•
const debounce = (func, wait) => {
  let timeout;
  return (...args) => {
    clearTimeout(timeout);
    timeout = setTimeout(() => {
      func(...args);
    }, wait);
  };
};
```

å› ä¸º ç®­å¤´å‡½æ•°æœ¬èº«æ²¡æœ‰è‡ªå·±çš„ `this` æ‰€æœ‰æ¨è `ç®­å¤´å‡½æ•°å¤–å±‚ + æ™®é€šå‡½æ•°è¿”å›` ç‰ˆ

```js
const debounce = (func, wait) => {
  let timeout;
  return function (...args) {
    const context = this;
    clearTimeout(timeout);
    timeout = setTimeout(() => {
      func.apply(context, args);
    }, wait);
  };
};
```

## èŠ‚æµ

`èŠ‚æµï¼ˆthrottleï¼‰= å›ºå®šæ—¶é—´é—´éš”å†…æœ€å¤šè§¦å‘ä¸€æ¬¡`

ç®€å•ç‰ˆæœ¬

```js
function throttle(func, wait) {
  let lastTime = 0;

  return function(...args) {
    const now = Date.now();

    if(now - lastTime >= wait) {
      lastTime = now();
      func.apply(this, args)
    }
  }
}
```

è¿›é˜¶ç‰ˆæœ¬

å…è®¸é…ç½®
leading: false â†’ ä¸€å¼€å§‹å…ˆä¸è§¦å‘
trailing: true â†’ ç»“æŸåå†æ‰§è¡Œä¸€æ¬¡

```js
function throttle(func, wait. options = {}) {
  let timeout = null
  let previous = 0

  return function(...args) {
    const context = this
    const now = Date.now()

    if (!previous & options.leading === false) previous = now

    const remaining = wait - (now - previous)

    if(remaining <= 0) {
      clearTimeout(timeout)
      timeout = null;
      previous = now
      func.apply(context, args)
    } else if(!timeout && && options.trailing !== false) {
      timeout = setTimeout(() => {
        previous = options.leading === false ? 0 : Date.now()
        timeout = null
        func.apply(context, args)
      }, remaining)
    }
  }
}
```
